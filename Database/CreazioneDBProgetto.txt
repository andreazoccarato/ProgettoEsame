.open dbProgettoEsame.db

PRAGMA foreign_keys = ON;

DROP TABLE IF EXISTS Scuola;
CREATE TABLE Scuola(
CodiceScuola INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
Nome TEXT NOT NULL UNIQUE,
Indirizzo TEXT NOT NULL UNIQUE,
Città TEXT NOT NULL UNIQUE
);

DROP TABLE IF EXISTS Classe;
CREATE TABLE Classe(
Sezione TEXT NOT NULL UNIQUE PRIMARY KEY,
Indirizzo TEXT NOT NULL,
CodiceScuola INTEGER NOT NULL,
FOREIGN KEY (CodiceScuola) REFERENCES Scuola(CodiceScuola)
);


DROP TABLE IF EXISTS Studente;
CREATE TABLE Studente(
CodiceFiscale TEXT PRIMARY KEY NOT NULL,
Nome TEXT NOT NULL,
Cognome TEXT NOT NULL,
DataNascita DATE NOT NULL,
Sezione TEXT NOT NULL,
IdCredenziali INTEGER NOT NULL,
UNIQUE(Nome,Cognome),
FOREIGN KEY (Sezione) REFERENCES Classe (Sezione),
FOREIGN KEY (IdCredenziali) REFERENCES Credenziali(ID)
);

DROP TABLE IF EXISTS Docente;
CREATE TABLE Docente(
CodiceFiscale TEXT PRIMARY KEY NOT NULL,
Nome TEXT NOT NULL,
Cognome TEXT NOT NULL,
DataNascita TEXT NOT NULL,
IdCredenziali INTEGER NOT NULL,
UNIQUE(Nome,Cognome),
FOREIGN KEY (IdCredenziali) REFERENCES Credenziali(ID)
);

DROP TABLE IF EXISTS tbrDocenteClasse;
CREATE TABLE tbrDocenteClasse(
ID INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
CodiceFiscale TEXT NOT NULL,
Sezione TEXT NOT NULL,
FOREIGN KEY (Sezione) REFERENCES Classe(Sezione),
FOREIGN KEY (CodiceFiscale) REFERENCES Docente(CodiceFiscale)
);

DROP TABLE IF EXISTS Lezione;
CREATE TABLE Lezione(
ID INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
Data DATE NOT NULL,
Ora INTEGER,
Materia TEXT NOT NULL,
Descrizione TEXT,
CFDocente TEXT NOT NULL,
FOREIGN KEY (CFDocente) REFERENCES Docente(CodiceFiscale)
);

DROP TABLE IF EXISTS Valutazione;
CREATE TABLE Valutazione(
ID INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
Voto TEXT NOT NULL,
Data DATE NOT NULL,
Ora INTEGER,
CFStudente TEXT NOT NULL,
CFDocente TEXT NOT NULL,
FOREIGN KEY (CFDocente) REFERENCES Docente(CodiceFiscale),
FOREIGN KEY (CFStudente) REFERENCES Studente(CodiceFiscale)
);

DROP TABLE IF EXISTS Assenza;
CREATE TABLE Assenza(
IdAssenza INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
Data DATE NOT NULL,
Ora INTEGER,
Giustificato BOOLEAN NOT NULL DEFAULT FALSE,
CFStudente TEXT NOT NULL,
FOREIGN KEY (CFStudente) REFERENCES Studente(CodiceFiscale)
);

DROP TABLE IF EXISTS Giustifica;
CREATE TABLE Giustifica(
IdGiustifica INTEGER PRIMARY KEY  AUTOINCREMENT  NOT NULL,
Data DATE NOT NULL,
IdAssenza INTEGER NOT NULL,
CFDocente TEXT NOT NULL,
FOREIGN KEY (CFDocente) REFERENCES Docente(CodiceFiscale)
);

DROP TABLE IF EXIST Credenziali;
CREATE TABLE Credenziali(
ID INTEGER PRIMARY KEY AUTOINCREMENT  NOT NULL,
Username TEXT NOT NULL,
Password TEXT NOT NULL
);